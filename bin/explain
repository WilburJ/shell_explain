#!/usr/bin/env ruby
require 'shell_explain'
require 'ansi/core'
require 'ansi/progressbar'

# example:
# $ explain "cut -d ' ' -f 1 /var/log/apache2/access_logs | uniq -c | sort -n"

# get cmd
@cmd = ARGV[0]

#progress bar
pbar = ANSI::Progressbar.new("Test Bar", 100)

def run(pbar)
  puts "get explain data".ansi(:green)
  pbar.inc
  doc = ShellExplain::Site.get_data(@cmd)
  commands = ShellExplain::Site.get_command(doc).uniq
  explains = ShellExplain::Site.get_explain(doc)

  @results = commands.zip(explains)
  pbar.finish
end

pbar.transfer_mode
run(pbar)
puts ("+"*20)+"Explain Shell"+("+"*20)

# input results
# puts "--results: #{@results.inspect}"

puts "invalid command".ansi(:red) if @results.empty?
@results.each do |re|
	puts "#{re[0]}".ansi(:red)
	puts ("-"*50).ansi(:green)
	puts re[1].ansi(:yellow)
end


